/*
 -- Cos16 --

 If you're wondering, I hard-coded this program,
 because it wouldn't make sense to include the
 whole emulator just for one demo.
*/

var cos16canvas = $("#cos16demo")[0];
var cos16ctx = cos16canvas.getContext("2d");

var rendercanvas = $('#renderdemo')[0];
var renderctx = rendercanvas.getContext("2d");

// Define variables
let x = 0, y = 0;
let vx = 1, vy = 1;
let pixel_x, pixel_y;
let center, focal_length = 560;
let rot = 0;


// Matrices
function rotateX(vec, angle) {
    let cosA = Math.cos(angle);
    let sinA = Math.sin(angle);
    return [
        vec[0],
        vec[1] * cosA - vec[2] * sinA,
        vec[1] * sinA + vec[2] * cosA
    ];
}
function rotateY(vec, angle) {
    let cosA = Math.cos(angle);
    let sinA = Math.sin(angle);
    return [
        vec[0] * cosA + vec[2] * sinA,
        vec[1],
        -vec[0] * sinA + vec[2] * cosA
    ];
}




// Function to get normal
function normalize(vec) {
    let length = Math.sqrt(vec[0] ** 2 + vec[1] ** 2 + vec[2] ** 2);
    return length === 0 ? [0, 0, 0] : [vec[0] / length, vec[1] / length, vec[2] / length];
}

// Function to calculate the dot product of two vectors
function dotProduct(a, b) {
    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];
}

// Function to calculate the cross product of two vectors
function crossProduct(a, b) {
    return [
        a[1] * b[2] - a[2] * b[1],
        a[2] * b[0] - a[0] * b[2],
        a[0] * b[1] - a[1] * b[0]
    ];
}

// Light direction (normalized)
let lightDir = normalize([-1, 1, 0]);

// Converts an RGB array to a hex string
function rgbToHex(color) {
    return `#${color.map(c => c.toString(16).padStart(2, '0')).join('')}`;
}

// Function to calculate the normal of a face
function getNormal(vertices, face) {
    // Extract vertices of the face
    let A = vertices[face[0]];
    let B = vertices[face[1]];
    let C = vertices[face[2]];

    // Compute edges
    let edge1 = [B[0] - A[0], B[1] - A[1], B[2] - A[2]];
    let edge2 = [C[0] - A[0], C[1] - A[1], C[2] - A[2]];

    // Calculate the normal (cross product)
    let normal = crossProduct(edge1, edge2);

    // Normalize the normal vector
    return normalize(normal);
}

// Function to calculate shading intensity
function getShading(vert_list, face) {
    let normal = getNormal(vert_list, face);
    let intensity = Math.max(0, dotProduct(normal, lightDir));
    return [0, 1, 2].map(() => Math.min(Math.floor(128 * intensity) + 56, 255));
}




// Resize canvas properly
function resizeCanvas() {
    cos16canvas.width = cos16canvas.clientWidth;
    cos16canvas.height = cos16canvas.clientHeight;
    rendercanvas.width = rendercanvas.clientWidth;
    rendercanvas.height = rendercanvas.clientHeight;
    focal_length = rendercanvas.width*.8;

    center = [rendercanvas.width / 2, rendercanvas.height / 2 - 20 - rendercanvas.height*.1];

    pixel_x = cos16canvas.width / (cos16canvas.width / 8);
    pixel_y = cos16canvas.height / (cos16canvas.height / 8);
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

// Set constants
const vertices = [[800, 0, 0], [792, 53, 0], [770, 103, 0], [736, 146, 0], [692, 177, 0], [640, 195, 0], [586, 199, 0], [533, 188, 0], [484, 163, 0], [445, 126, 0], [416, 79, 0], [401, 27, 0], [401, -26, 0], [416, -79, 0], [444, -125, 0], [484, -163, 0], [532, -188, 0], [585, -199, 0], [640, -195, 0], [691, -177, 0], [736, -146, 0], [770, -104, 0], [792, -54, 0], [799, 0, 0], [783, 0, 160], [776, 53, 159], [755, 103, 155], [721, 146, 148], [677, 177, 139], [627, 195, 128], [574, 199, 118], [522, 188, 107], [474, 163, 97], [435, 126, 89], [408, 79, 83], [393, 27, 80], [393, -26, 80], [407, -79, 83], [435, -125, 89], [474, -163, 97], [521, -188, 107], [573, -199, 117], [627, -195, 128], [677, -177, 139], [721, -146, 148], [754, -104, 155], [776, -54, 159], [783, 0, 160], [735, 0, 315], [728, 53, 312], [708, 103, 303], [676, 146, 290], [636, 177, 272], [588, 195, 252], [539, 199, 231], [490, 188, 210], [445, 163, 191], [408, 126, 175], [382, 79, 164], [369, 27, 158], [369, -26, 158], [382, -79, 164], [408, -125, 175], [445, -163, 190], [489, -188, 209], [538, -199, 230], [588, -195, 252], [635, -177, 272], [676, -146, 290], [708, -104, 303], [728, -54, 312], [735, 0, 315], [656, 0, 456], [650, 53, 452], [632, 103, 440], [604, 146, 420], [568, 177, 395], [526, 195, 365], [481, 199, 334], [437, 188, 304], [398, 163, 276], [365, 126, 254], [342, 79, 237], [329, 27, 229], [329, -26, 229], [341, -79, 237], [365, -125, 253], [397, -163, 276], [437, -188, 304], [480, -199, 334], [525, -195, 365], [567, -177, 394], [604, -146, 420], [632, -104, 440], [650, -54, 452], [656, 0, 456], [551, 0, 579], [546, 53, 574], [531, 103, 558], [507, 146, 533], [477, 177, 501], [441, 195, 464], [404, 199, 424], [367, 188, 386], [334, 163, 351], [306, 126, 322], [287, 79, 301], [277, 27, 291], [276, -26, 291], [287, -79, 301], [306, -125, 322], [333, -163, 350], [367, -188, 385], [403, -199, 424], [441, -195, 463], [476, -177, 501], [507, -146, 533], [531, -104, 558], [546, -54, 574], [551, 0, 579], [423, 0, 678], [419, 53, 672], [408, 103, 654], [389, 146, 624], [366, 177, 587], [339, 195, 543], [310, 199, 497], [282, 188, 452], [256, 163, 411], [235, 126, 377], [220, 79, 353], [212, 27, 340], [212, -26, 340], [220, -79, 353], [235, -125, 377], [256, -163, 410], [281, -188, 451], [310, -199, 497], [338, -195, 543], [366, -177, 586], [389, -146, 624], [407, -104, 653], [419, -54, 672], [423, 0, 678], [278, 0, 750], [275, 53, 743], [268, 103, 722], [256, 146, 690], [240, 177, 648], [222, 195, 600], [204, 199, 549], [185, 188, 499], [168, 163, 454], [154, 126, 417], [144, 79, 390], [139, 27, 376], [139, -26, 376], [144, -79, 390], [154, -125, 416], [168, -163, 454], [185, -188, 499], [203, -199, 549], [222, -195, 600], [240, -177, 648], [256, -146, 690], [268, -104, 722], [275, -54, 742], [278, 0, 750], [121, 0, 790], [120, 53, 783], [117, 103, 761], [112, 146, 727], [105, 177, 684], [97, 195, 633], [89, 199, 579], [81, 188, 526], [73, 163, 479], [67, 126, 439], [63, 79, 411], [61, 27, 397], [61, -26, 397], [63, -79, 411], [67, -125, 439], [73, -163, 478], [81, -188, 526], [89, -199, 579], [97, -195, 632], [105, -177, 683], [111, -146, 727], [117, -104, 761], [120, -54, 783], [121, 0, 790], [-39, 0, 799], [-39, 53, 791], [-38, 103, 769], [-36, 146, 735], [-34, 177, 691], [-31, 195, 640], [-29, 199, 585], [-26, 188, 532], [-24, 163, 484], [-22, 126, 444], [-20, 79, 416], [-20, 27, 401], [-20, -26, 401], [-20, -79, 415], [-22, -125, 444], [-24, -163, 483], [-26, -188, 531], [-29, -199, 585], [-31, -195, 639], [-34, -177, 690], [-36, -146, 735], [-38, -104, 769], [-39, -54, 791], [-39, 0, 799], [-199, 0, 774], [-197, 53, 767], [-192, 103, 746], [-183, 146, 713], [-172, 177, 670], [-160, 195, 620], [-146, 199, 567], [-133, 188, 516], [-121, 163, 469], [-111, 126, 430], [-104, 79, 403], [-100, 27, 389], [-100, -26, 389], [-104, -79, 403], [-111, -125, 430], [-120, -163, 468], [-133, -188, 515], [-146, -199, 567], [-159, -195, 619], [-172, -177, 669], [-183, -146, 712], [-192, -104, 746], [-197, -54, 767], [-199, 0, 774], [-351, 0, 718], [-348, 53, 711], [-338, 103, 692], [-323, 146, 661], [-304, 177, 621], [-281, 195, 575], [-257, 199, 526], [-234, 188, 478], [-213, 163, 435], [-195, 126, 399], [-183, 79, 374], [-176, 27, 361], [-176, -26, 360], [-183, -79, 374], [-195, -125, 399], [-212, -163, 435], [-234, -188, 478], [-257, -199, 526], [-281, -195, 575], [-303, -177, 621], [-323, -146, 661], [-338, -104, 692], [-348, -54, 711], [-351, 0, 718], [-488, 0, 633], [-484, 53, 627], [-471, 103, 610], [-450, 146, 582], [-423, 177, 547], [-391, 195, 507], [-358, 199, 464], [-325, 188, 422], [-296, 163, 383], [-271, 126, 352], [-254, 79, 329], [-245, 27, 318], [-245, -26, 318], [-254, -79, 329], [-271, -125, 351], [-296, -163, 383], [-325, -188, 421], [-358, -199, 463], [-391, -195, 506], [-422, -177, 547], [-449, -146, 582], [-470, -104, 609], [-484, -54, 627], [-488, 0, 633], [-606, 0, 521], [-600, 53, 517], [-584, 103, 502], [-558, 146, 480], [-524, 177, 451], [-485, 195, 418], [-444, 199, 382], [-404, 188, 347], [-367, 163, 316], [-337, 126, 290], [-315, 79, 271], [-304, 27, 262], [-304, -26, 262], [-315, -79, 271], [-336, -125, 290], [-367, -163, 315], [-403, -188, 347], [-444, -199, 382], [-485, -195, 417], [-524, -177, 451], [-557, -146, 480], [-584, -104, 502], [-600, -54, 516], [-606, 0, 521], [-698, 0, 389], [-692, 53, 385], [-673, 103, 375], [-643, 146, 358], [-604, 177, 336], [-559, 195, 311], [-512, 199, 285], [-465, 188, 259], [-423, 163, 235], [-388, 126, 216], [-364, 79, 202], [-351, 27, 195], [-351, -26, 195], [-363, -79, 202], [-388, -125, 216], [-423, -163, 235], [-465, -188, 259], [-511, -199, 285], [-559, -195, 311], [-604, -177, 336], [-643, -146, 358], [-673, -104, 374], [-692, -54, 385], [-698, 0, 389], [-762, 0, 240], [-755, 53, 238], [-735, 103, 231], [-702, 146, 221], [-660, 177, 208], [-611, 195, 192], [-559, 199, 176], [-508, 188, 160], [-462, 163, 145], [-424, 126, 133], [-397, 79, 125], [-383, 27, 120], [-383, -26, 120], [-397, -79, 125], [-424, -125, 133], [-461, -163, 145], [-507, -188, 160], [-558, -199, 176], [-610, -195, 192], [-659, -177, 207], [-702, -146, 221], [-734, -104, 231], [-755, -54, 238], [-762, 0, 240], [-795, 0, 82], [-788, 53, 81], [-766, 103, 79], [-732, 146, 75], [-688, 177, 71], [-637, 195, 65], [-583, 199, 60], [-530, 188, 54], [-482, 163, 49], [-442, 126, 45], [-414, 79, 42], [-399, 27, 41], [-399, -26, 41], [-414, -79, 42], [-442, -125, 45], [-481, -163, 49], [-529, -188, 54], [-582, -199, 60], [-636, -195, 65], [-687, -177, 71], [-732, -146, 75], [-766, -104, 79], [-788, -54, 81], [-795, 0, 82], [-796, 0, -79], [-788, 53, -78], [-767, 103, -76], [-732, 146, -73], [-688, 177, -68], [-637, 195, -63], [-583, 199, -58], [-530, 188, -53], [-482, 163, -48], [-442, 126, -44], [-414, 79, -41], [-399, 27, -40], [-399, -26, -39], [-414, -79, -41], [-442, -125, -44], [-481, -163, -48], [-529, -188, -53], [-582, -199, -58], [-637, -195, -63], [-688, -177, -68], [-732, -146, -73], [-766, -104, -76], [-788, -54, -78], [-796, 0, -79], [-763, 0, -238], [-756, 53, -235], [-735, 103, -229], [-703, 146, -219], [-660, 177, -206], [-611, 195, -190], [-559, 199, -174], [-509, 188, -158], [-462, 163, -144], [-424, 126, -132], [-397, 79, -124], [-383, 27, -119], [-383, -26, -119], [-397, -79, -123], [-424, -125, -132], [-462, -163, -144], [-508, -188, -158], [-559, -199, -174], [-611, -195, -190], [-660, -177, -205], [-702, -146, -219], [-735, -104, -229], [-756, -54, -235], [-763, 0, -238], [-700, 0, -386], [-693, 53, -383], [-674, 103, -372], [-644, 146, -356], [-605, 177, -334], [-560, 195, -309], [-513, 199, -283], [-466, 188, -257], [-424, 163, -234], [-389, 126, -215], [-364, 79, -201], [-351, 27, -194], [-351, -26, -194], [-364, -79, -201], [-389, -125, -215], [-423, -163, -234], [-466, -188, -257], [-512, -199, -283], [-560, -195, -309], [-605, -177, -334], [-644, -146, -356], [-674, -104, -372], [-693, -54, -383], [-700, 0, -386], [-608, 0, -519], [-602, 53, -515], [-585, 103, -501], [-559, 146, -478], [-526, 177, -449], [-487, 195, -416], [-445, 199, -381], [-405, 188, -346], [-368, 163, -315], [-338, 126, -289], [-316, 79, -270], [-305, 27, -261], [-305, -26, -261], [-316, -79, -270], [-337, -125, -288], [-368, -163, -314], [-404, -188, -346], [-445, -199, -380], [-486, -195, -416], [-525, -177, -449], [-559, -146, -478], [-585, -104, -500], [-602, -54, -514], [-608, 0, -519], [-490, 0, -631], [-486, 53, -625], [-473, 103, -608], [-452, 146, -581], [-424, 177, -546], [-393, 195, -505], [-359, 199, -463], [-327, 188, -420], [-297, 163, -382], [-273, 126, -351], [-255, 79, -328], [-246, 27, -317], [-246, -26, -317], [-255, -79, -328], [-272, -125, -351], [-297, -163, -382], [-326, -188, -420], [-359, -199, -462], [-392, -195, -505], [-424, -177, -545], [-451, -146, -581], [-472, -104, -608], [-486, -54, -625], [-490, 0, -631], [-353, 0, -717], [-350, 53, -710], [-340, 103, -691], [-325, 146, -660], [-306, 177, -620], [-283, 195, -574], [-259, 199, -526], [-235, 188, -478], [-214, 163, -434], [-196, 126, -399], [-184, 79, -373], [-177, 27, -360], [-177, -26, -360], [-184, -79, -373], [-196, -125, -398], [-214, -163, -434], [-235, -188, -477], [-259, -199, -525], [-283, -195, -574], [-305, -177, -620], [-325, -146, -660], [-340, -104, -691], [-350, -54, -710], [-353, 0, -717], [-202, 0, -774], [-200, 53, -766], [-194, 103, -745], [-186, 146, -712], [-174, 177, -669], [-162, 195, -620], [-148, 199, -567], [-134, 188, -515], [-122, 163, -469], [-112, 126, -430], [-105, 79, -403], [-101, 27, -388], [-101, -26, -388], [-105, -79, -402], [-112, -125, -430], [-122, -163, -468], [-134, -188, -515], [-148, -199, -566], [-161, -195, -619], [-174, -177, -669], [-186, -146, -712], [-194, -104, -745], [-200, -54, -766], [-202, 0, -774], [-42, 0, -798], [-42, 53, -791], [-40, 103, -769], [-39, 146, -735], [-36, 177, -691], [-33, 195, -639], [-31, 199, -585], [-28, 188, -532], [-25, 163, -484], [-23, 126, -444], [-22, 79, -416], [-21, 27, -401], [-21, -26, -401], [-22, -79, -415], [-23, -125, -443], [-25, -163, -483], [-28, -188, -531], [-31, -199, -585], [-33, -195, -639], [-36, -177, -690], [-39, -146, -735], [-40, -104, -769], [-42, -54, -791], [-42, 0, -798], [119, 0, -791], [118, 53, -783], [114, 103, -762], [109, 146, -728], [103, 177, -684], [95, 195, -633], [87, 199, -579], [79, 188, -527], [72, 163, -479], [66, 126, -440], [62, 79, -412], [59, 27, -397], [59, -26, -397], [62, -79, -411], [66, -125, -439], [72, -163, -478], [79, -188, -526], [87, -199, -579], [95, -195, -633], [103, -177, -683], [109, -146, -727], [114, -104, -761], [118, -54, -783], [119, 0, -791], [275, 0, -750], [273, 53, -743], [265, 103, -723], [254, 146, -691], [238, 177, -649], [221, 195, -601], [202, 199, -550], [183, 188, -500], [167, 163, -455], [153, 126, -417], [143, 79, -391], [138, 27, -377], [138, -26, -377], [143, -79, -390], [153, -125, -417], [167, -163, -454], [183, -188, -499], [202, -199, -549], [220, -195, -600], [238, -177, -649], [253, -146, -690], [265, -104, -723], [273, -54, -743], [275, 0, -750], [421, 0, -680], [417, 53, -673], [406, 103, -655], [387, 146, -626], [364, 177, -588], [337, 195, -544], [308, 199, -498], [280, 188, -453], [255, 163, -412], [234, 126, -378], [219, 79, -354], [211, 27, -341], [211, -26, -341], [219, -79, -353], [234, -125, -377], [255, -163, -411], [280, -188, -452], [308, -199, -498], [337, -195, -544], [364, -177, -587], [387, -146, -625], [405, -104, -655], [417, -54, -673], [421, 0, -680], [549, 0, -581], [544, 53, -575], [529, 103, -560], [505, 146, -535], [475, 177, -502], [440, 195, -465], [402, 199, -426], [366, 188, -387], [333, 163, -352], [305, 126, -323], [286, 79, -302], [276, 27, -292], [276, -26, -292], [286, -79, -302], [305, -125, -323], [332, -163, -351], [365, -188, -387], [402, -199, -425], [439, -195, -465], [475, -177, -502], [505, -146, -534], [529, -104, -559], [544, -54, -575], [549, 0, -581], [655, 0, -458], [649, 53, -454], [631, 103, -442], [603, 146, -422], [566, 177, -397], [524, 195, -367], [480, 199, -336], [436, 188, -305], [397, 163, -278], [364, 126, -255], [341, 79, -239], [329, 27, -230], [329, -26, -230], [341, -79, -238], [364, -125, -255], [396, -163, -277], [436, -188, -305], [479, -199, -336], [524, -195, -367], [566, -177, -396], [602, -146, -422], [631, -104, -442], [649, -54, -454], [655, 0, -458], [734, 0, -317], [727, 53, -314], [707, 103, -306], [676, 146, -292], [635, 177, -274], [588, 195, -254], [538, 199, -232], [489, 188, -211], [444, 163, -192], [408, 126, -176], [382, 79, -165], [368, 27, -159], [368, -26, -159], [382, -79, -165], [408, -125, -176], [444, -163, -192], [488, -188, -211], [537, -199, -232], [587, -195, -254], [634, -177, -274], [675, -146, -292], [707, -104, -305], [727, -54, -314], [734, 0, -317], [783, 0, -163], [775, 53, -161], [754, 103, -157], [721, 146, -150], [677, 177, -141], [627, 195, -130], [574, 199, -119], [521, 188, -108], [474, 163, -99], [435, 126, -90], [407, 79, -85], [393, 27, -82], [393, -26, -82], [407, -79, -85], [435, -125, -90], [474, -163, -98], [521, -188, -108], [573, -199, -119], [626, -195, -130], [676, -177, -141], [720, -146, -150], [754, -104, -157], [775, -54, -161], [783, 0, -163], [799, 0, -2], [792, 53, -2], [770, 103, -2], [736, 146, -2], [692, 177, -2], [640, 195, -2], [586, 199, -1], [533, 188, -1], [484, 163, -1], [445, 126, -1], [416, 79, -1], [401, 27, -1], [401, -26, -1], [416, -79, -1], [444, -125, -1], [484, -163, -1], [532, -188, -1], [585, -199, -1], [640, -195, -2], [691, -177, -2], [736, -146, -2], [770, -104, -2], [792, -54, -2], [799, 0, -2]];


const faces = [[0, 24, 1], [25, 1, 24], [1, 25, 2], [26, 2, 25], [2, 26, 3], [27, 3, 26], [3, 27, 4], [28, 4, 27], [4, 28, 5], [29, 5, 28], [5, 29, 6], [30, 6, 29], [6, 30, 7], [31, 7, 30], [7, 31, 8], [32, 8, 31], [8, 32, 9], [33, 9, 32], [9, 33, 10], [34, 10, 33], [10, 34, 11], [35, 11, 34], [11, 35, 12], [36, 12, 35], [12, 36, 13], [37, 13, 36], [13, 37, 14], [38, 14, 37], [14, 38, 15], [39, 15, 38], [15, 39, 16], [40, 16, 39], [16, 40, 17], [41, 17, 40], [17, 41, 18], [42, 18, 41], [18, 42, 19], [43, 19, 42], [19, 43, 20], [44, 20, 43], [20, 44, 21], [45, 21, 44], [21, 45, 22], [46, 22, 45], [22, 46, 23], [47, 23, 46], [23, 47, 0], [24, 0, 47], [24, 48, 25], [49, 25, 48], [25, 49, 26], [50, 26, 49], [26, 50, 27], [51, 27, 50], [27, 51, 28], [52, 28, 51], [28, 52, 29], [53, 29, 52], [29, 53, 30], [54, 30, 53], [30, 54, 31], [55, 31, 54], [31, 55, 32], [56, 32, 55], [32, 56, 33], [57, 33, 56], [33, 57, 34], [58, 34, 57], [34, 58, 35], [59, 35, 58], [35, 59, 36], [60, 36, 59], [36, 60, 37], [61, 37, 60], [37, 61, 38], [62, 38, 61], [38, 62, 39], [63, 39, 62], [39, 63, 40], [64, 40, 63], [40, 64, 41], [65, 41, 64], [41, 65, 42], [66, 42, 65], [42, 66, 43], [67, 43, 66], [43, 67, 44], [68, 44, 67], [44, 68, 45], [69, 45, 68], [45, 69, 46], [70, 46, 69], [46, 70, 47], [71, 47, 70], [47, 71, 24], [48, 24, 71], [48, 72, 49], [73, 49, 72], [49, 73, 50], [74, 50, 73], [50, 74, 51], [75, 51, 74], [51, 75, 52], [76, 52, 75], [52, 76, 53], [77, 53, 76], [53, 77, 54], [78, 54, 77], [54, 78, 55], [79, 55, 78], [55, 79, 56], [80, 56, 79], [56, 80, 57], [81, 57, 80], [57, 81, 58], [82, 58, 81], [58, 82, 59], [83, 59, 82], [59, 83, 60], [84, 60, 83], [60, 84, 61], [85, 61, 84], [61, 85, 62], [86, 62, 85], [62, 86, 63], [87, 63, 86], [63, 87, 64], [88, 64, 87], [64, 88, 65], [89, 65, 88], [65, 89, 66], [90, 66, 89], [66, 90, 67], [91, 67, 90], [67, 91, 68], [92, 68, 91], [68, 92, 69], [93, 69, 92], [69, 93, 70], [94, 70, 93], [70, 94, 71], [95, 71, 94], [71, 95, 48], [72, 48, 95], [72, 96, 73], [97, 73, 96], [73, 97, 74], [98, 74, 97], [74, 98, 75], [99, 75, 98], [75, 99, 76], [100, 76, 99], [76, 100, 77], [101, 77, 100], [77, 101, 78], [102, 78, 101], [78, 102, 79], [103, 79, 102], [79, 103, 80], [104, 80, 103], [80, 104, 81], [105, 81, 104], [81, 105, 82], [106, 82, 105], [82, 106, 83], [107, 83, 106], [83, 107, 84], [108, 84, 107], [84, 108, 85], [109, 85, 108], [85, 109, 86], [110, 86, 109], [86, 110, 87], [111, 87, 110], [87, 111, 88], [112, 88, 111], [88, 112, 89], [113, 89, 112], [89, 113, 90], [114, 90, 113], [90, 114, 91], [115, 91, 114], [91, 115, 92], [116, 92, 115], [92, 116, 93], [117, 93, 116], [93, 117, 94], [118, 94, 117], [94, 118, 95], [119, 95, 118], [95, 119, 72], [96, 72, 119], [96, 120, 97], [121, 97, 120], [97, 121, 98], [122, 98, 121], [98, 122, 99], [123, 99, 122], [99, 123, 100], [124, 100, 123], [100, 124, 101], [125, 101, 124], [101, 125, 102], [126, 102, 125], [102, 126, 103], [127, 103, 126], [103, 127, 104], [128, 104, 127], [104, 128, 105], [129, 105, 128], [105, 129, 106], [130, 106, 129], [106, 130, 107], [131, 107, 130], [107, 131, 108], [132, 108, 131], [108, 132, 109], [133, 109, 132], [109, 133, 110], [134, 110, 133], [110, 134, 111], [135, 111, 134], [111, 135, 112], [136, 112, 135], [112, 136, 113], [137, 113, 136], [113, 137, 114], [138, 114, 137], [114, 138, 115], [139, 115, 138], [115, 139, 116], [140, 116, 139], [116, 140, 117], [141, 117, 140], [117, 141, 118], [142, 118, 141], [118, 142, 119], [143, 119, 142], [119, 143, 96], [120, 96, 143], [120, 144, 121], [145, 121, 144], [121, 145, 122], [146, 122, 145], [122, 146, 123], [147, 123, 146], [123, 147, 124], [148, 124, 147], [124, 148, 125], [149, 125, 148], [125, 149, 126], [150, 126, 149], [126, 150, 127], [151, 127, 150], [127, 151, 128], [152, 128, 151], [128, 152, 129], [153, 129, 152], [129, 153, 130], [154, 130, 153], [130, 154, 131], [155, 131, 154], [131, 155, 132], [156, 132, 155], [132, 156, 133], [157, 133, 156], [133, 157, 134], [158, 134, 157], [134, 158, 135], [159, 135, 158], [135, 159, 136], [160, 136, 159], [136, 160, 137], [161, 137, 160], [137, 161, 138], [162, 138, 161], [138, 162, 139], [163, 139, 162], [139, 163, 140], [164, 140, 163], [140, 164, 141], [165, 141, 164], [141, 165, 142], [166, 142, 165], [142, 166, 143], [167, 143, 166], [143, 167, 120], [144, 120, 167], [144, 168, 145], [169, 145, 168], [145, 169, 146], [170, 146, 169], [146, 170, 147], [171, 147, 170], [147, 171, 148], [172, 148, 171], [148, 172, 149], [173, 149, 172], [149, 173, 150], [174, 150, 173], [150, 174, 151], [175, 151, 174], [151, 175, 152], [176, 152, 175], [152, 176, 153], [177, 153, 176], [153, 177, 154], [178, 154, 177], [154, 178, 155], [179, 155, 178], [155, 179, 156], [180, 156, 179], [156, 180, 157], [181, 157, 180], [157, 181, 158], [182, 158, 181], [158, 182, 159], [183, 159, 182], [159, 183, 160], [184, 160, 183], [160, 184, 161], [185, 161, 184], [161, 185, 162], [186, 162, 185], [162, 186, 163], [187, 163, 186], [163, 187, 164], [188, 164, 187], [164, 188, 165], [189, 165, 188], [165, 189, 166], [190, 166, 189], [166, 190, 167], [191, 167, 190], [167, 191, 144], [168, 144, 191], [168, 192, 169], [193, 169, 192], [169, 193, 170], [194, 170, 193], [170, 194, 171], [195, 171, 194], [171, 195, 172], [196, 172, 195], [172, 196, 173], [197, 173, 196], [173, 197, 174], [198, 174, 197], [174, 198, 175], [199, 175, 198], [175, 199, 176], [200, 176, 199], [176, 200, 177], [201, 177, 200], [177, 201, 178], [202, 178, 201], [178, 202, 179], [203, 179, 202], [179, 203, 180], [204, 180, 203], [180, 204, 181], [205, 181, 204], [181, 205, 182], [206, 182, 205], [182, 206, 183], [207, 183, 206], [183, 207, 184], [208, 184, 207], [184, 208, 185], [209, 185, 208], [185, 209, 186], [210, 186, 209], [186, 210, 187], [211, 187, 210], [187, 211, 188], [212, 188, 211], [188, 212, 189], [213, 189, 212], [189, 213, 190], [214, 190, 213], [190, 214, 191], [215, 191, 214], [191, 215, 168], [192, 168, 215], [192, 216, 193], [217, 193, 216], [193, 217, 194], [218, 194, 217], [194, 218, 195], [219, 195, 218], [195, 219, 196], [220, 196, 219], [196, 220, 197], [221, 197, 220], [197, 221, 198], [222, 198, 221], [198, 222, 199], [223, 199, 222], [199, 223, 200], [224, 200, 223], [200, 224, 201], [225, 201, 224], [201, 225, 202], [226, 202, 225], [202, 226, 203], [227, 203, 226], [203, 227, 204], [228, 204, 227], [204, 228, 205], [229, 205, 228], [205, 229, 206], [230, 206, 229], [206, 230, 207], [231, 207, 230], [207, 231, 208], [232, 208, 231], [208, 232, 209], [233, 209, 232], [209, 233, 210], [234, 210, 233], [210, 234, 211], [235, 211, 234], [211, 235, 212], [236, 212, 235], [212, 236, 213], [237, 213, 236], [213, 237, 214], [238, 214, 237], [214, 238, 215], [239, 215, 238], [215, 239, 192], [216, 192, 239], [216, 240, 217], [241, 217, 240], [217, 241, 218], [242, 218, 241], [218, 242, 219], [243, 219, 242], [219, 243, 220], [244, 220, 243], [220, 244, 221], [245, 221, 244], [221, 245, 222], [246, 222, 245], [222, 246, 223], [247, 223, 246], [223, 247, 224], [248, 224, 247], [224, 248, 225], [249, 225, 248], [225, 249, 226], [250, 226, 249], [226, 250, 227], [251, 227, 250], [227, 251, 228], [252, 228, 251], [228, 252, 229], [253, 229, 252], [229, 253, 230], [254, 230, 253], [230, 254, 231], [255, 231, 254], [231, 255, 232], [256, 232, 255], [232, 256, 233], [257, 233, 256], [233, 257, 234], [258, 234, 257], [234, 258, 235], [259, 235, 258], [235, 259, 236], [260, 236, 259], [236, 260, 237], [261, 237, 260], [237, 261, 238], [262, 238, 261], [238, 262, 239], [263, 239, 262], [239, 263, 216], [240, 216, 263], [240, 264, 241], [265, 241, 264], [241, 265, 242], [266, 242, 265], [242, 266, 243], [267, 243, 266], [243, 267, 244], [268, 244, 267], [244, 268, 245], [269, 245, 268], [245, 269, 246], [270, 246, 269], [246, 270, 247], [271, 247, 270], [247, 271, 248], [272, 248, 271], [248, 272, 249], [273, 249, 272], [249, 273, 250], [274, 250, 273], [250, 274, 251], [275, 251, 274], [251, 275, 252], [276, 252, 275], [252, 276, 253], [277, 253, 276], [253, 277, 254], [278, 254, 277], [254, 278, 255], [279, 255, 278], [255, 279, 256], [280, 256, 279], [256, 280, 257], [281, 257, 280], [257, 281, 258], [282, 258, 281], [258, 282, 259], [283, 259, 282], [259, 283, 260], [284, 260, 283], [260, 284, 261], [285, 261, 284], [261, 285, 262], [286, 262, 285], [262, 286, 263], [287, 263, 286], [263, 287, 240], [264, 240, 287], [264, 288, 265], [289, 265, 288], [265, 289, 266], [290, 266, 289], [266, 290, 267], [291, 267, 290], [267, 291, 268], [292, 268, 291], [268, 292, 269], [293, 269, 292], [269, 293, 270], [294, 270, 293], [270, 294, 271], [295, 271, 294], [271, 295, 272], [296, 272, 295], [272, 296, 273], [297, 273, 296], [273, 297, 274], [298, 274, 297], [274, 298, 275], [299, 275, 298], [275, 299, 276], [300, 276, 299], [276, 300, 277], [301, 277, 300], [277, 301, 278], [302, 278, 301], [278, 302, 279], [303, 279, 302], [279, 303, 280], [304, 280, 303], [280, 304, 281], [305, 281, 304], [281, 305, 282], [306, 282, 305], [282, 306, 283], [307, 283, 306], [283, 307, 284], [308, 284, 307], [284, 308, 285], [309, 285, 308], [285, 309, 286], [310, 286, 309], [286, 310, 287], [311, 287, 310], [287, 311, 264], [288, 264, 311], [288, 312, 289], [313, 289, 312], [289, 313, 290], [314, 290, 313], [290, 314, 291], [315, 291, 314], [291, 315, 292], [316, 292, 315], [292, 316, 293], [317, 293, 316], [293, 317, 294], [318, 294, 317], [294, 318, 295], [319, 295, 318], [295, 319, 296], [320, 296, 319], [296, 320, 297], [321, 297, 320], [297, 321, 298], [322, 298, 321], [298, 322, 299], [323, 299, 322], [299, 323, 300], [324, 300, 323], [300, 324, 301], [325, 301, 324], [301, 325, 302], [326, 302, 325], [302, 326, 303], [327, 303, 326], [303, 327, 304], [328, 304, 327], [304, 328, 305], [329, 305, 328], [305, 329, 306], [330, 306, 329], [306, 330, 307], [331, 307, 330], [307, 331, 308], [332, 308, 331], [308, 332, 309], [333, 309, 332], [309, 333, 310], [334, 310, 333], [310, 334, 311], [335, 311, 334], [311, 335, 288], [312, 288, 335], [312, 336, 313], [337, 313, 336], [313, 337, 314], [338, 314, 337], [314, 338, 315], [339, 315, 338], [315, 339, 316], [340, 316, 339], [316, 340, 317], [341, 317, 340], [317, 341, 318], [342, 318, 341], [318, 342, 319], [343, 319, 342], [319, 343, 320], [344, 320, 343], [320, 344, 321], [345, 321, 344], [321, 345, 322], [346, 322, 345], [322, 346, 323], [347, 323, 346], [323, 347, 324], [348, 324, 347], [324, 348, 325], [349, 325, 348], [325, 349, 326], [350, 326, 349], [326, 350, 327], [351, 327, 350], [327, 351, 328], [352, 328, 351], [328, 352, 329], [353, 329, 352], [329, 353, 330], [354, 330, 353], [330, 354, 331], [355, 331, 354], [331, 355, 332], [356, 332, 355], [332, 356, 333], [357, 333, 356], [333, 357, 334], [358, 334, 357], [334, 358, 335], [359, 335, 358], [335, 359, 312], [336, 312, 359], [336, 360, 337], [361, 337, 360], [337, 361, 338], [362, 338, 361], [338, 362, 339], [363, 339, 362], [339, 363, 340], [364, 340, 363], [340, 364, 341], [365, 341, 364], [341, 365, 342], [366, 342, 365], [342, 366, 343], [367, 343, 366], [343, 367, 344], [368, 344, 367], [344, 368, 345], [369, 345, 368], [345, 369, 346], [370, 346, 369], [346, 370, 347], [371, 347, 370], [347, 371, 348], [372, 348, 371], [348, 372, 349], [373, 349, 372], [349, 373, 350], [374, 350, 373], [350, 374, 351], [375, 351, 374], [351, 375, 352], [376, 352, 375], [352, 376, 353], [377, 353, 376], [353, 377, 354], [378, 354, 377], [354, 378, 355], [379, 355, 378], [355, 379, 356], [380, 356, 379], [356, 380, 357], [381, 357, 380], [357, 381, 358], [382, 358, 381], [358, 382, 359], [383, 359, 382], [359, 383, 336], [360, 336, 383], [360, 384, 361], [385, 361, 384], [361, 385, 362], [386, 362, 385], [362, 386, 363], [387, 363, 386], [363, 387, 364], [388, 364, 387], [364, 388, 365], [389, 365, 388], [365, 389, 366], [390, 366, 389], [366, 390, 367], [391, 367, 390], [367, 391, 368], [392, 368, 391], [368, 392, 369], [393, 369, 392], [369, 393, 370], [394, 370, 393], [370, 394, 371], [395, 371, 394], [371, 395, 372], [396, 372, 395], [372, 396, 373], [397, 373, 396], [373, 397, 374], [398, 374, 397], [374, 398, 375], [399, 375, 398], [375, 399, 376], [400, 376, 399], [376, 400, 377], [401, 377, 400], [377, 401, 378], [402, 378, 401], [378, 402, 379], [403, 379, 402], [379, 403, 380], [404, 380, 403], [380, 404, 381], [405, 381, 404], [381, 405, 382], [406, 382, 405], [382, 406, 383], [407, 383, 406], [383, 407, 360], [384, 360, 407], [384, 408, 385], [409, 385, 408], [385, 409, 386], [410, 386, 409], [386, 410, 387], [411, 387, 410], [387, 411, 388], [412, 388, 411], [388, 412, 389], [413, 389, 412], [389, 413, 390], [414, 390, 413], [390, 414, 391], [415, 391, 414], [391, 415, 392], [416, 392, 415], [392, 416, 393], [417, 393, 416], [393, 417, 394], [418, 394, 417], [394, 418, 395], [419, 395, 418], [395, 419, 396], [420, 396, 419], [396, 420, 397], [421, 397, 420], [397, 421, 398], [422, 398, 421], [398, 422, 399], [423, 399, 422], [399, 423, 400], [424, 400, 423], [400, 424, 401], [425, 401, 424], [401, 425, 402], [426, 402, 425], [402, 426, 403], [427, 403, 426], [403, 427, 404], [428, 404, 427], [404, 428, 405], [429, 405, 428], [405, 429, 406], [430, 406, 429], [406, 430, 407], [431, 407, 430], [407, 431, 384], [408, 384, 431], [408, 432, 409], [433, 409, 432], [409, 433, 410], [434, 410, 433], [410, 434, 411], [435, 411, 434], [411, 435, 412], [436, 412, 435], [412, 436, 413], [437, 413, 436], [413, 437, 414], [438, 414, 437], [414, 438, 415], [439, 415, 438], [415, 439, 416], [440, 416, 439], [416, 440, 417], [441, 417, 440], [417, 441, 418], [442, 418, 441], [418, 442, 419], [443, 419, 442], [419, 443, 420], [444, 420, 443], [420, 444, 421], [445, 421, 444], [421, 445, 422], [446, 422, 445], [422, 446, 423], [447, 423, 446], [423, 447, 424], [448, 424, 447], [424, 448, 425], [449, 425, 448], [425, 449, 426], [450, 426, 449], [426, 450, 427], [451, 427, 450], [427, 451, 428], [452, 428, 451], [428, 452, 429], [453, 429, 452], [429, 453, 430], [454, 430, 453], [430, 454, 431], [455, 431, 454], [431, 455, 408], [432, 408, 455], [432, 456, 433], [457, 433, 456], [433, 457, 434], [458, 434, 457], [434, 458, 435], [459, 435, 458], [435, 459, 436], [460, 436, 459], [436, 460, 437], [461, 437, 460], [437, 461, 438], [462, 438, 461], [438, 462, 439], [463, 439, 462], [439, 463, 440], [464, 440, 463], [440, 464, 441], [465, 441, 464], [441, 465, 442], [466, 442, 465], [442, 466, 443], [467, 443, 466], [443, 467, 444], [468, 444, 467], [444, 468, 445], [469, 445, 468], [445, 469, 446], [470, 446, 469], [446, 470, 447], [471, 447, 470], [447, 471, 448], [472, 448, 471], [448, 472, 449], [473, 449, 472], [449, 473, 450], [474, 450, 473], [450, 474, 451], [475, 451, 474], [451, 475, 452], [476, 452, 475], [452, 476, 453], [477, 453, 476], [453, 477, 454], [478, 454, 477], [454, 478, 455], [479, 455, 478], [455, 479, 432], [456, 432, 479], [456, 480, 457], [481, 457, 480], [457, 481, 458], [482, 458, 481], [458, 482, 459], [483, 459, 482], [459, 483, 460], [484, 460, 483], [460, 484, 461], [485, 461, 484], [461, 485, 462], [486, 462, 485], [462, 486, 463], [487, 463, 486], [463, 487, 464], [488, 464, 487], [464, 488, 465], [489, 465, 488], [465, 489, 466], [490, 466, 489], [466, 490, 467], [491, 467, 490], [467, 491, 468], [492, 468, 491], [468, 492, 469], [493, 469, 492], [469, 493, 470], [494, 470, 493], [470, 494, 471], [495, 471, 494], [471, 495, 472], [496, 472, 495], [472, 496, 473], [497, 473, 496], [473, 497, 474], [498, 474, 497], [474, 498, 475], [499, 475, 498], [475, 499, 476], [500, 476, 499], [476, 500, 477], [501, 477, 500], [477, 501, 478], [502, 478, 501], [478, 502, 479], [503, 479, 502], [479, 503, 456], [480, 456, 503], [480, 504, 481], [505, 481, 504], [481, 505, 482], [506, 482, 505], [482, 506, 483], [507, 483, 506], [483, 507, 484], [508, 484, 507], [484, 508, 485], [509, 485, 508], [485, 509, 486], [510, 486, 509], [486, 510, 487], [511, 487, 510], [487, 511, 488], [512, 488, 511], [488, 512, 489], [513, 489, 512], [489, 513, 490], [514, 490, 513], [490, 514, 491], [515, 491, 514], [491, 515, 492], [516, 492, 515], [492, 516, 493], [517, 493, 516], [493, 517, 494], [518, 494, 517], [494, 518, 495], [519, 495, 518], [495, 519, 496], [520, 496, 519], [496, 520, 497], [521, 497, 520], [497, 521, 498], [522, 498, 521], [498, 522, 499], [523, 499, 522], [499, 523, 500], [524, 500, 523], [500, 524, 501], [525, 501, 524], [501, 525, 502], [526, 502, 525], [502, 526, 503], [527, 503, 526], [503, 527, 480], [504, 480, 527], [504, 528, 505], [529, 505, 528], [505, 529, 506], [530, 506, 529], [506, 530, 507], [531, 507, 530], [507, 531, 508], [532, 508, 531], [508, 532, 509], [533, 509, 532], [509, 533, 510], [534, 510, 533], [510, 534, 511], [535, 511, 534], [511, 535, 512], [536, 512, 535], [512, 536, 513], [537, 513, 536], [513, 537, 514], [538, 514, 537], [514, 538, 515], [539, 515, 538], [515, 539, 516], [540, 516, 539], [516, 540, 517], [541, 517, 540], [517, 541, 518], [542, 518, 541], [518, 542, 519], [543, 519, 542], [519, 543, 520], [544, 520, 543], [520, 544, 521], [545, 521, 544], [521, 545, 522], [546, 522, 545], [522, 546, 523], [547, 523, 546], [523, 547, 524], [548, 524, 547], [524, 548, 525], [549, 525, 548], [525, 549, 526], [550, 526, 549], [526, 550, 527], [551, 527, 550], [527, 551, 504], [528, 504, 551], [528, 552, 529], [553, 529, 552], [529, 553, 530], [554, 530, 553], [530, 554, 531], [555, 531, 554], [531, 555, 532], [556, 532, 555], [532, 556, 533], [557, 533, 556], [533, 557, 534], [558, 534, 557], [534, 558, 535], [559, 535, 558], [535, 559, 536], [560, 536, 559], [536, 560, 537], [561, 537, 560], [537, 561, 538], [562, 538, 561], [538, 562, 539], [563, 539, 562], [539, 563, 540], [564, 540, 563], [540, 564, 541], [565, 541, 564], [541, 565, 542], [566, 542, 565], [542, 566, 543], [567, 543, 566], [543, 567, 544], [568, 544, 567], [544, 568, 545], [569, 545, 568], [545, 569, 546], [570, 546, 569], [546, 570, 547], [571, 547, 570], [547, 571, 548], [572, 548, 571], [548, 572, 549], [573, 549, 572], [549, 573, 550], [574, 550, 573], [550, 574, 551], [575, 551, 574], [551, 575, 528], [552, 528, 575], [552, 576, 553], [577, 553, 576], [553, 577, 554], [578, 554, 577], [554, 578, 555], [579, 555, 578], [555, 579, 556], [580, 556, 579], [556, 580, 557], [581, 557, 580], [557, 581, 558], [582, 558, 581], [558, 582, 559], [583, 559, 582], [559, 583, 560], [584, 560, 583], [560, 584, 561], [585, 561, 584], [561, 585, 562], [586, 562, 585], [562, 586, 563], [587, 563, 586], [563, 587, 564], [588, 564, 587], [564, 588, 565], [589, 565, 588], [565, 589, 566], [590, 566, 589], [566, 590, 567], [591, 567, 590], [567, 591, 568], [592, 568, 591], [568, 592, 569], [593, 569, 592], [569, 593, 570], [594, 570, 593], [570, 594, 571], [595, 571, 594], [571, 595, 572], [596, 572, 595], [572, 596, 573], [597, 573, 596], [573, 597, 574], [598, 574, 597], [574, 598, 575], [599, 575, 598], [575, 599, 552], [576, 552, 599], [576, 600, 577], [601, 577, 600], [577, 601, 578], [602, 578, 601], [578, 602, 579], [603, 579, 602], [579, 603, 580], [604, 580, 603], [580, 604, 581], [605, 581, 604], [581, 605, 582], [606, 582, 605], [582, 606, 583], [607, 583, 606], [583, 607, 584], [608, 584, 607], [584, 608, 585], [609, 585, 608], [585, 609, 586], [610, 586, 609], [586, 610, 587], [611, 587, 610], [587, 611, 588], [612, 588, 611], [588, 612, 589], [613, 589, 612], [589, 613, 590], [614, 590, 613], [590, 614, 591], [615, 591, 614], [591, 615, 592], [616, 592, 615], [592, 616, 593], [617, 593, 616], [593, 617, 594], [618, 594, 617], [594, 618, 595], [619, 595, 618], [595, 619, 596], [620, 596, 619], [596, 620, 597], [621, 597, 620], [597, 621, 598], [622, 598, 621], [598, 622, 599], [623, 599, 622], [599, 623, 576], [600, 576, 623], [600, 624, 601], [625, 601, 624], [601, 625, 602], [626, 602, 625], [602, 626, 603], [627, 603, 626], [603, 627, 604], [628, 604, 627], [604, 628, 605], [629, 605, 628], [605, 629, 606], [630, 606, 629], [606, 630, 607], [631, 607, 630], [607, 631, 608], [632, 608, 631], [608, 632, 609], [633, 609, 632], [609, 633, 610], [634, 610, 633], [610, 634, 611], [635, 611, 634], [611, 635, 612], [636, 612, 635], [612, 636, 613], [637, 613, 636], [613, 637, 614], [638, 614, 637], [614, 638, 615], [639, 615, 638], [615, 639, 616], [640, 616, 639], [616, 640, 617], [641, 617, 640], [617, 641, 618], [642, 618, 641], [618, 642, 619], [643, 619, 642], [619, 643, 620], [644, 620, 643], [620, 644, 621], [645, 621, 644], [621, 645, 622], [646, 622, 645], [622, 646, 623], [647, 623, 646], [623, 647, 600], [624, 600, 647], [624, 648, 625], [649, 625, 648], [625, 649, 626], [650, 626, 649], [626, 650, 627], [651, 627, 650], [627, 651, 628], [652, 628, 651], [628, 652, 629], [653, 629, 652], [629, 653, 630], [654, 630, 653], [630, 654, 631], [655, 631, 654], [631, 655, 632], [656, 632, 655], [632, 656, 633], [657, 633, 656], [633, 657, 634], [658, 634, 657], [634, 658, 635], [659, 635, 658], [635, 659, 636], [660, 636, 659], [636, 660, 637], [661, 637, 660], [637, 661, 638], [662, 638, 661], [638, 662, 639], [663, 639, 662], [639, 663, 640], [664, 640, 663], [640, 664, 641], [665, 641, 664], [641, 665, 642], [666, 642, 665], [642, 666, 643], [667, 643, 666], [643, 667, 644], [668, 644, 667], [644, 668, 645], [669, 645, 668], [645, 669, 646], [670, 646, 669], [646, 670, 647], [671, 647, 670], [647, 671, 624], [648, 624, 671], [648, 672, 649], [673, 649, 672], [649, 673, 650], [674, 650, 673], [650, 674, 651], [675, 651, 674], [651, 675, 652], [676, 652, 675], [652, 676, 653], [677, 653, 676], [653, 677, 654], [678, 654, 677], [654, 678, 655], [679, 655, 678], [655, 679, 656], [680, 656, 679], [656, 680, 657], [681, 657, 680], [657, 681, 658], [682, 658, 681], [658, 682, 659], [683, 659, 682], [659, 683, 660], [684, 660, 683], [660, 684, 661], [685, 661, 684], [661, 685, 662], [686, 662, 685], [662, 686, 663], [687, 663, 686], [663, 687, 664], [688, 664, 687], [664, 688, 665], [689, 665, 688], [665, 689, 666], [690, 666, 689], [666, 690, 667], [691, 667, 690], [667, 691, 668], [692, 668, 691], [668, 692, 669], [693, 669, 692], [669, 693, 670], [694, 670, 693], [670, 694, 671], [695, 671, 694], [671, 695, 648], [672, 648, 695], [672, 696, 673], [697, 673, 696], [673, 697, 674], [698, 674, 697], [674, 698, 675], [699, 675, 698], [675, 699, 676], [700, 676, 699], [676, 700, 677], [701, 677, 700], [677, 701, 678], [702, 678, 701], [678, 702, 679], [703, 679, 702], [679, 703, 680], [704, 680, 703], [680, 704, 681], [705, 681, 704], [681, 705, 682], [706, 682, 705], [682, 706, 683], [707, 683, 706], [683, 707, 684], [708, 684, 707], [684, 708, 685], [709, 685, 708], [685, 709, 686], [710, 686, 709], [686, 710, 687], [711, 687, 710], [687, 711, 688], [712, 688, 711], [688, 712, 689], [713, 689, 712], [689, 713, 690], [714, 690, 713], [690, 714, 691], [715, 691, 714], [691, 715, 692], [716, 692, 715], [692, 716, 693], [717, 693, 716], [693, 717, 694], [718, 694, 717], [694, 718, 695], [719, 695, 718], [695, 719, 672], [696, 672, 719], [696, 720, 697], [721, 697, 720], [697, 721, 698], [722, 698, 721], [698, 722, 699], [723, 699, 722], [699, 723, 700], [724, 700, 723], [700, 724, 701], [725, 701, 724], [701, 725, 702], [726, 702, 725], [702, 726, 703], [727, 703, 726], [703, 727, 704], [728, 704, 727], [704, 728, 705], [729, 705, 728], [705, 729, 706], [730, 706, 729], [706, 730, 707], [731, 707, 730], [707, 731, 708], [732, 708, 731], [708, 732, 709], [733, 709, 732], [709, 733, 710], [734, 710, 733], [710, 734, 711], [735, 711, 734], [711, 735, 712], [736, 712, 735], [712, 736, 713], [737, 713, 736], [713, 737, 714], [738, 714, 737], [714, 738, 715], [739, 715, 738], [715, 739, 716], [740, 716, 739], [716, 740, 717], [741, 717, 740], [717, 741, 718], [742, 718, 741], [718, 742, 719], [743, 719, 742], [719, 743, 696], [720, 696, 743], [720, 744, 721], [745, 721, 744], [721, 745, 722], [746, 722, 745], [722, 746, 723], [747, 723, 746], [723, 747, 724], [748, 724, 747], [724, 748, 725], [749, 725, 748], [725, 749, 726], [750, 726, 749], [726, 750, 727], [751, 727, 750], [727, 751, 728], [752, 728, 751], [728, 752, 729], [753, 729, 752], [729, 753, 730], [754, 730, 753], [730, 754, 731], [755, 731, 754], [731, 755, 732], [756, 732, 755], [732, 756, 733], [757, 733, 756], [733, 757, 734], [758, 734, 757], [734, 758, 735], [759, 735, 758], [735, 759, 736], [760, 736, 759], [736, 760, 737], [761, 737, 760], [737, 761, 738], [762, 738, 761], [738, 762, 739], [763, 739, 762], [739, 763, 740], [764, 740, 763], [740, 764, 741], [765, 741, 764], [741, 765, 742], [766, 742, 765], [742, 766, 743], [767, 743, 766], [743, 767, 720], [744, 720, 767], [744, 0, 745], [1, 745, 0], [745, 1, 746], [2, 746, 1], [746, 2, 747], [3, 747, 2], [747, 3, 748], [4, 748, 3], [748, 4, 749], [5, 749, 4], [749, 5, 750], [6, 750, 5], [750, 6, 751], [7, 751, 6], [751, 7, 752], [8, 752, 7], [752, 8, 753], [9, 753, 8], [753, 9, 754], [10, 754, 9], [754, 10, 755], [11, 755, 10], [755, 11, 756], [12, 756, 11], [756, 12, 757], [13, 757, 12], [757, 13, 758], [14, 758, 13], [758, 14, 759], [15, 759, 14], [759, 15, 760], [16, 760, 15], [760, 16, 761], [17, 761, 16], [761, 17, 762], [18, 762, 17], [762, 18, 763], [19, 763, 18], [763, 19, 764], [20, 764, 19], [764, 20, 765], [21, 765, 20], [765, 21, 766], [22, 766, 21], [766, 22, 767], [23, 767, 22], [767, 23, 744], [0, 744, 23]];

let position = [0, -100, -1400];




// Mainloop
function tick() {
    // Update position
    x += vx;
    y += vy;
    
    // Check for bounce
    if (x >= cos16canvas.width / pixel_x - 1 || x <= 0) vx = -vx;
    if (y >= cos16canvas.height / pixel_y - 1 || y <= 0) vy = -vy;

    // Clear screen
    cos16ctx.fillStyle = "#000";
    cos16ctx.fillRect(0, 0, cos16canvas.width, cos16canvas.height);
    renderctx.fillStyle = "#000";
    renderctx.fillRect(0, 0, rendercanvas.width, rendercanvas.height);
    
    // Draw pixel
    cos16ctx.fillStyle = "#fff";
    cos16ctx.fillRect(x * pixel_x, y * pixel_y, pixel_x, pixel_y);
    
    // Rotate vertices
    let rotated = [];
    vertices.forEach(function(pos) {
        let npos = rotateY(pos, rot);
        npos = rotateX(npos, .4);
        
        rotated.push(npos);
    });
    
    // Sort faces by depth
    let sorted = faces.map((face, index) => {
        let avgDepth = (rotated[face[0]][2] + rotated[face[1]][2] + rotated[face[2]][2]) / 3;
        return { face, depth: avgDepth };
    });
    // Sort faces from furthest to closest (ascending order)
    sorted.sort((b, a) => a.depth - b.depth);

    // Calculate Projected position
    let projected = [];
    //renderctx.fillStyle = "#00ffff";
    rotated.forEach(function(pos) {
        let x = pos[0] - position[0];
        let y = pos[1] - position[1];
        let z = pos[2] - position[2];
        let x_proj = (focal_length * x) / (focal_length + z);
        let y_proj = (focal_length * y) / (focal_length + z);
        projected.push([x_proj, y_proj]);
        
        //renderctx.fillRect(center[0] + x_proj, center[1] + y_proj, 2, 2);
    });

    
    // Draw Faces
    sorted.forEach(({ face }) => {
        renderctx.fillStyle = rgbToHex(getShading(rotated, face));

        vert0 = projected[face[0]];
        vert1 = projected[face[1]];
        vert2 = projected[face[2]];

        renderctx.beginPath();
        renderctx.moveTo(center[0]+vert0[0], center[1]+vert0[1]);
        renderctx.lineTo(center[0]+vert1[0], center[1]+vert1[1])
        renderctx.lineTo(center[0]+vert2[0], center[1]+vert2[1])
        renderctx.closePath();
        renderctx.fill();
    });

    rot += 0.01;

    setTimeout(function() {requestAnimationFrame(tick);}, 30)
}

tick();